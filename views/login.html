<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>KapanBeli - Login & Register</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght @300;400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

<style>
*{
margin:0;
padding:0;
box-sizing:border-box;
font-family:Poppins;
}

body{
height:100vh;
background:linear-gradient(135deg,#ffe3a3,#ffb347);
display:flex;
align-items:center;
justify-content:center;
transition:.4s;
}

.container{
width:100%;
display:flex;
justify-content:center;
}

.card{
width:900px;
height:520px;
background:white;
border-radius:20px;
display:flex;
overflow:hidden;
box-shadow:0 20px 40px rgba(0,0,0,.2);
}

/* LEFT PANEL */
.left-panel{
width:50%;
background:linear-gradient(135deg,#ffd27f,#ffb347);
display:flex;
align-items:center;
justify-content:center;
flex-direction:column;
text-align:center;
padding:40px;
}

.left-panel i{
font-size:90px;
color:white;
margin-bottom:20px;
animation:float 4s ease-in-out infinite;
}

.left-panel h1{
font-size:36px;
color:white;
}

.left-panel p{
margin-top:10px;
color:white;
opacity:.9;
}

/* RIGHT PANEL */
.right-panel{
width:50%;
background:#222;
padding:40px;
position:relative;
overflow:hidden;
}

/* DARK TOGGLE */
.dark-toggle{
position:absolute;
top:15px;
right:15px;
width:45px;
height:25px;
background:#ffb347;
border-radius:20px;
cursor:pointer;
}

.dark-toggle::before{
content:"";
width:21px;
height:21px;
background:white;
border-radius:50%;
position:absolute;
top:2px;
left:2px;
transition:.3s;
}

.dark-mode .dark-toggle::before{
transform:translateX(20px);
}

/* TABS */
.tabs{
display:flex;
justify-content:center;
gap:50px;
margin-bottom:25px;
color:#aaa;
font-weight:600;
}

.tab{
cursor:pointer;
}

.tab.active{
color:#ffb347;
border-bottom:2px solid #ffb347;
padding-bottom:5px;
}

/* WRAPPER */
.forms-wrapper{
width:200%;
display:flex;
transition:.6s;
}

.form-box{
width:50%;
padding:0 10px;
opacity:0;
transform:translateY(10px);
transition:.4s;
}

.form-box.active{
opacity:1;
transform:translateY(0);
}

/* FORM */
h2{
text-align:center;
color:white;
margin-bottom:25px;
}

.input-group{
position:relative;
margin-bottom:18px;
}

.input-group input{
width:100%;
padding:13px 40px;
border:none;
border-radius:8px;
background:#333;
color:white;
}

.input-group i{
position:absolute;
left:12px;
top:50%;
transform:translateY(-50%);
color:#aaa;
}

.input-icon {
position: absolute;
right: 12px;
top: 50%;
transform: translateY(-50%);
color: #aaa;
cursor: pointer;
z-index: 10;
}

button{
width:100%;
padding:13px;
border:none;
border-radius:8px;
background:#ffb347;
color:black;
font-weight:600;
cursor:pointer;
margin-top:10px;
}

button:hover{
background:#ffa200;
}

small{
color:#aaa;
display:block;
text-align:center;
margin-top:15px;
}

small span{
color:#ffb347;
cursor:pointer;
}

/* DARK MODE */
.dark-mode{
background:linear-gradient(135deg,#111,#000);
}

.dark-mode .card{
background:#1c1c1c;
}

.dark-mode .right-panel{
background:#111;
}

.dark-mode input{
background:#222;
}

/* ANIMATION */
 @keyframes float{
0%,100%{transform:translateY(0);}
50%{transform:translateY(-15px);}
}

 @media (max-width:768px){
.card{
flex-direction:column;
height:auto;
}
.left-panel,.right-panel{
width:100%;
}
}
</style>
</head>

<body>

<div class="container">
<div class="card">

<!-- LEFT -->
<div class="left-panel">
<i class="fas fa-book"></i>
<h1>KapanBeli</h1>
<p>Catat semua barang yang ingin kamu beli</p>
</div>

<!-- RIGHT -->
<div class="right-panel">

<div class="dark-toggle" id="darkToggle"></div>

<div class="tabs">
<div class="tab active" id="loginTab">Masuk</div>
<div class="tab" id="registerTab">Daftar</div>
</div>

<div class="forms-wrapper" id="wrapper">

<!-- LOGIN -->
<form class="form-box active" id="loginForm">

<h2>Login</h2>

<div class="input-group">
<i class="fas fa-envelope"></i>
<input type="email" id="loginEmail" placeholder="Email" required>
</div>

<div class="input-group">
<i class="fas fa-lock"></i>
<input type="password" id="loginPassword" placeholder="Password" required>
<i class="fas fa-eye input-icon" id="toggleLoginPassword"></i>
</div>

<button type="submit">Masuk</button>

<small>Belum punya akun? <span id="toRegister">Daftar</span></small>

</form>

<!-- REGISTER -->
<form class="form-box" id="registerForm">

<h2>Register</h2>

<div class="input-group">
<i class="fas fa-user"></i>
<input type="text" id="registerName" placeholder="Nama Lengkap" required>
</div>

<div class="input-group">
<i class="fas fa-envelope"></i>
<input type="email" id="registerEmail" placeholder="Email" required>
</div>

<div class="input-group">
<i class="fas fa-lock"></i>
<input type="password" id="registerPassword" placeholder="Password" required>
<i class="fas fa-eye input-icon" id="toggleRegisterPassword"></i>
</div>

<div class="input-group">
<i class="fas fa-lock"></i>
<input type="password" id="registerConfirmPassword" placeholder="Konfirmasi Password" required>
<i class="fas fa-eye input-icon" id="toggleRegisterConfirmPassword"></i>
</div>

<button type="submit">Daftar</button>

<small>Sudah punya akun? <span id="toLogin">Masuk</span></small>

</form>

</div>
</div>
</div>
</div>
</div>

<script>
const wrapper=document.getElementById("wrapper");
const loginForm=document.getElementById("loginForm");
const registerForm=document.getElementById("registerForm");

const loginTab=document.getElementById("loginTab");
const registerTab=document.getElementById("registerTab");

const toRegister=document.getElementById("toRegister");
const toLogin=document.getElementById("toLogin");

function showLogin(){
wrapper.style.transform="translateX(0)";
loginForm.classList.add("active");
registerForm.classList.remove("active");
loginTab.classList.add("active");
registerTab.classList.remove("active");
// Clear any alerts when switching to login
clearAlerts();
}

function showRegister(){
wrapper.style.transform="translateX(-50%)";
registerForm.classList.add("active");
loginForm.classList.remove("active");
registerTab.classList.add("active");
loginTab.classList.remove("active");
// Clear any alerts when switching to register
clearAlerts();
}

loginTab.onclick=showLogin;
registerTab.onclick=showRegister;
toRegister.onclick=showRegister;
toLogin.onclick=showLogin;

/* DARK MODE */
const toggle=document.getElementById("darkToggle");
toggle.onclick=()=>{
document.body.classList.toggle("dark-mode");
}

/* PASSWORD VISIBILITY TOGGLE */
const toggleLoginPassword = document.getElementById('toggleLoginPassword');
const loginPassword = document.getElementById('loginPassword');

toggleLoginPassword.onclick = () => {
    if (loginPassword.type === 'password') {
        loginPassword.type = 'text';
        toggleLoginPassword.classList.remove('fa-eye');
        toggleLoginPassword.classList.add('fa-eye-slash');
    } else {
        loginPassword.type = 'password';
        toggleLoginPassword.classList.remove('fa-eye-slash');
        toggleLoginPassword.classList.add('fa-eye');
    }
};

const toggleRegisterPassword = document.getElementById('toggleRegisterPassword');
const registerPassword = document.getElementById('registerPassword');

toggleRegisterPassword.onclick = () => {
    if (registerPassword.type === 'password') {
        registerPassword.type = 'text';
        toggleRegisterPassword.classList.remove('fa-eye');
        toggleRegisterPassword.classList.add('fa-eye-slash');
    } else {
        registerPassword.type = 'password';
        toggleRegisterPassword.classList.remove('fa-eye-slash');
        toggleRegisterPassword.classList.add('fa-eye');
    }
};

const toggleRegisterConfirmPassword = document.getElementById('toggleRegisterConfirmPassword');
const registerConfirmPassword = document.getElementById('registerConfirmPassword');

toggleRegisterConfirmPassword.onclick = () => {
    if (registerConfirmPassword.type === 'password') {
        registerConfirmPassword.type = 'text';
        toggleRegisterConfirmPassword.classList.remove('fa-eye');
        toggleRegisterConfirmPassword.classList.add('fa-eye-slash');
    } else {
        registerConfirmPassword.type = 'password';
        toggleRegisterConfirmPassword.classList.remove('fa-eye-slash');
        toggleRegisterConfirmPassword.classList.add('fa-eye');
    }
};

// Function to show alert messages
function showAlert(message, isError = false) {
    // Remove any existing alerts
    clearAlerts();

    // Create alert element
    const alertDiv = document.createElement('div');
    alertDiv.className = `alert ${isError ? 'alert-error' : 'alert-success'}`;
    alertDiv.textContent = message;
    alertDiv.style.marginTop = '10px';
    alertDiv.style.textAlign = 'center';
    alertDiv.style.padding = '10px';
    alertDiv.style.borderRadius = '5px';
    alertDiv.style.color = isError ? '#721c24' : '#155724';
    alertDiv.style.backgroundColor = isError ? '#f8d7da' : '#d4edda';
    alertDiv.style.border = `1px solid ${isError ? '#f5c6cb' : '#c3e6cb'}`;

    // Insert alert before the form buttons
    const loginButton = document.querySelector('#loginForm button[type="submit"]');
    const registerButton = document.querySelector('#registerForm button[type="submit"]');
    
    if (loginForm.classList.contains('active')) {
        loginButton.parentNode.insertBefore(alertDiv, loginButton.nextSibling);
    } else {
        registerButton.parentNode.insertBefore(alertDiv, registerButton.nextSibling);
    }
}

// Function to clear alerts
function clearAlerts() {
    const alerts = document.querySelectorAll('.alert');
    alerts.forEach(alert => alert.remove());
}

// Check for confirmation message on page load
window.onload = function() {
    const urlParams = new URLSearchParams(window.location.search);
    if (urlParams.get('confirmed') === 'true') {
        showAlert('Akun Anda telah berhasil dikonfirmasi! Silakan login.', false);
    }
};

/* LOGIN FUNCTIONALITY */
loginForm.onsubmit = async (e) => {
    e.preventDefault();

    const email = document.getElementById('loginEmail').value;
    const password = document.getElementById('loginPassword').value;

    try {
        const response = await fetch('/auth/login', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ email, password })
        });

        const result = await response.json();

        if (response.ok && result.success) {
            // Login berhasil, arahkan ke halaman beranda
            window.location.href = result.redirect || '/';
        } else {
            showAlert(result.message || 'Login gagal. Silakan coba lagi.', true);
        }
    } catch (error) {
        showAlert('Terjadi kesalahan saat login. Silakan coba lagi.', true);
    }
};

/* REGISTER FUNCTIONALITY */
registerForm.onsubmit = async (e) => {
    e.preventDefault();

    const name = document.getElementById('registerName').value;
    const email = document.getElementById('registerEmail').value;
    const password = document.getElementById('registerPassword').value;
    const confirmPassword = document.getElementById('registerConfirmPassword').value;

    // Validasi konfirmasi password
    if (password !== confirmPassword) {
        showAlert('Password tidak cocok!', true);
        return;
    }

    try {
        const response = await fetch('/auth/signup', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ name, email, password })
        });

        const result = await response.json();

        if (response.ok && result.success) {
            // Registrasi berhasil, tampilkan pesan dan arahkan ke login
            showAlert(result.message, false);
            // Optionally switch to login tab after a delay
            setTimeout(() => {
                showLogin();
            }, 3000);
        } else {
            showAlert(result.message || 'Registrasi gagal. Silakan coba lagi.', true);
        }
    } catch (error) {
        showAlert('Terjadi kesalahan saat registrasi. Silakan coba lagi.', true);
    }
};
</script>

</body>
</html>