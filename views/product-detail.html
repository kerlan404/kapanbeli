<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detail Produk - Kapan Beli</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸ›’</text></svg>" type="image/x-icon">

    <style>
        /* Reuse Variables */
        :root {
            --primary-blue: #2E86DE; --primary-orange: #FF9F43; --bg-body: #F0F4F8; --bg-card: #FFFFFF;
            --text-main: #2C3E50; --text-muted: #636E72; --radius: 16px; --shadow: 0 10px 30px rgba(0,0,0,0.05);
            --danger: #FF6B6B; --success: #1DD1A1; --warning: #FECA57;
        }
        body.dark-mode-active {
            --bg-body: #1E272E; --bg-card: #2C3E50; --text-main: #DFE6E9; --text-muted: #B2BEC3;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Poppins', sans-serif; transition: background 0.3s; }
        body { background: var(--bg-body); color: var(--text-main); min-height: 100vh; display: flex; flex-direction: column; }

        /* Navbar Simple */
        .navbar { background: var(--bg-card); padding: 15px 5%; box-shadow: 0 2px 10px rgba(0,0,0,0.05); display: flex; justify-content: space-between; align-items: center; }
        .back-btn { text-decoration: none; color: var(--text-main); font-weight: 600; display: flex; align-items: center; gap: 8px; }
        .back-btn:hover { color: var(--primary-orange); }

        /* Layout */
        .container { max-width: 1000px; margin: 40px auto; padding: 0 20px; flex: 1; }
        
        .detail-grid {
            display: grid; grid-template-columns: 1fr 1.5fr; gap: 40px; background: var(--bg-card);
            border-radius: var(--radius); padding: 40px; box-shadow: var(--shadow);
        }

        /* Left: Image */
        .detail-image {
            width: 100%; height: 300px; background: #f8f9fa; border-radius: 12px;
            display: flex; align-items: center; justify-content: center; overflow: hidden;
        }
        .detail-image img { width: 100%; height: 100%; object-fit: cover; }
        .detail-image i { font-size: 5rem; color: var(--text-muted); }

        /* Right: Info */
        .detail-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 20px; }
        .detail-title { font-size: 2rem; font-weight: 700; line-height: 1.2; }
        .action-icons { display: flex; gap: 10px; }
        .icon-btn { width: 40px; height: 40px; border-radius: 50%; border: 1px solid var(--text-muted); background: transparent; cursor: pointer; color: var(--text-main); display: flex; align-items: center; justify-content: center; }
        .icon-btn:hover { border-color: var(--primary-orange); color: var(--primary-orange); background: rgba(255,159,67,0.1); }
        .icon-btn.delete:hover { border-color: var(--danger); color: var(--danger); background: rgba(255,107,107,0.1); }

        .data-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px; }
        .data-item label { display: block; font-size: 0.85rem; color: var(--text-muted); margin-bottom: 5px; }
        .data-item span { font-size: 1.1rem; font-weight: 600; color: var(--text-main); }

        .status-badge { padding: 5px 12px; border-radius: 20px; font-size: 0.8rem; font-weight: 600; }
        .st-low { background: rgba(254, 202, 87, 0.2); color: #d35400; }
        .st-ok { background: rgba(29, 209, 161, 0.2); color: #1DD1A1; }
        .st-out { background: rgba(255, 107, 107, 0.2); color: #FF6B6B; }

        .desc-box { padding: 20px; background: rgba(0,0,0,0.02); border-radius: 12px; line-height: 1.6; color: var(--text-muted); }

        @media(max-width: 768px) { .detail-grid { grid-template-columns: 1fr; } .data-grid { grid-template-columns: 1fr; } }
    </style>
</head>
<body>

    <nav class="navbar">
        <a href="/products" class="back-btn"><i class="fas fa-arrow-left"></i> Kembali</a>
        <div style="font-weight: 700; color: var(--primary-orange);">Detail Produk</div>
    </nav>

    <div class="container">
        <div class="detail-grid">
            <!-- Left -->
            <div class="detail-image" id="prodImage">
                <i class="fas fa-spinner fa-spin"></i>
            </div>

            <!-- Right -->
            <div class="detail-content">
                <div class="detail-header">
                    <h1 class="detail-title" id="prodName">Loading...</h1>
                    <div class="action-icons">
                        <button class="icon-btn" onclick="editProd()" title="Edit"><i class="fas fa-pen"></i></button>
                        <button class="icon-btn delete" onclick="delProd()" title="Hapus"><i class="fas fa-trash"></i></button>
                    </div>
                </div>

                <div class="data-grid">
                    <div class="data-item">
                        <label>Harga Satuan</label>
                        <span id="prodPrice">Rp 0</span>
                    </div>
                    <div class="data-item">
                        <label>Sisa Stok</label>
                        <span id="prodStock">0</span>
                    </div>
                    <div class="data-item">
                        <label>Satuan</label>
                        <span id="prodUnit">-</span>
                    </div>
                    <div class="data-item">
                        <label>Min. Stok</label>
                        <span id="prodMin">0</span>
                    </div>
                    <div class="data-item">
                        <label>Kategori</label>
                        <span id="prodCat">-</span>
                    </div>
                    <div class="data-item">
                        <label>Kadaluarsa</label>
                        <span id="prodExp">-</span>
                    </div>
                </div>

                <div class="desc-box">
                    <strong>Deskripsi / Catatan:</strong><br><br>
                    <span id="prodDesc">-</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- LOGIC (Server Connection Preserved) ---
        const id = window.location.pathname.split('/').pop();

        async function loadDetail() {
            try {
                const res = await fetch(`/api/products/${id}`);
                const data = await res.json();
                if(data.success) {
                    const p = data.product;
                    document.getElementById('prodName').innerText = p.name;
                    document.getElementById('prodPrice').innerText = `Rp ${parseInt(p.price).toLocaleString('id-ID')}`;
                    document.getElementById('prodStock').innerText = `${p.stock_quantity} ${p.unit||''}`;
                    document.getElementById('prodUnit').innerText = p.unit || '-';
                    document.getElementById('prodMin').innerText = p.min_stock_level;
                    document.getElementById('prodCat').innerText = p.category_id || '-';
                    document.getElementById('prodDesc').innerText = p.description || p.notes || 'Tidak ada catatan.';
                    
                    // Expiry Formatting
                    if(p.expiry_date) {
                        const d = new Date(p.expiry_date).toLocaleDateString('id-ID');
                        document.getElementById('prodExp').innerText = d;
                    }

                    // Image
                    const imgDiv = document.getElementById('prodImage');
                    if(p.image_url) {
                        imgDiv.innerHTML = `<img src="${p.image_url}" alt="${p.name}">`;
                    } else {
                        imgDiv.innerHTML = `<i class="fas fa-box-open" style="font-size: 5rem; color: var(--text-muted);"></i>`;
                    }

                    // Stock Badge
                    const stockEl = document.getElementById('prodStock');
                    stockEl.className = 'status-badge';
                    if(p.stock_quantity <= 0) { stockEl.classList.add('st-out'); stockEl.innerText += ' (Habis)'; }
                    else if(p.stock_quantity <= p.min_stock_level) { stockEl.classList.add('st-low'); stockEl.innerText += ' (Rendah)'; }
                    else { stockEl.classList.add('st-ok'); stockEl.innerText += ' (Aman)'; }

                } else {
                    alert('Produk tidak ditemukan'); window.location.href='/products';
                }
            } catch(e) { console.error(e); alert('Gagal memuat data'); }
        }

        function editProd() { window.location.href = `/products/edit/${id}`; }

        async function delProd() {
            if(!confirm('Yakin hapus produk ini?')) return;
            try {
                const res = await fetch(`/api/products/${id}`, { method: 'DELETE' });
                const data = await res.json();
                if(data.success) { alert('Produk dihapus'); window.location.href='/products'; }
            } catch(e) { alert('Gagal menghapus'); }
        }

        document.addEventListener('DOMContentLoaded', loadDetail);
    </script>
</body>
</html>